<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scheduling Rules Creator</title>
    <script type="module">
        import PositionNode from './model/PositionNode.js';
        import Attributes from './model/Attributes.js';
        import Expression from './model/Expression.js';
        import FunctionType from './model/FunctionType.js';
        import Function from './model/Function.js';
        import Operation from './model/Operation.js';
        import OperatorType from './model/OperatorType.js';
        import FilterSophon from './model/FilterSophon.js';
        import FilterForecast from './model/FilterForecast.js';
        import PositionReference from './model/PositionReference.js';
        import SophonSide from './model/SophonSide.js';

        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('createRuleBtn').addEventListener('click', () => {
                const ref = document.getElementById('ref').value;
                const brief = document.getElementById('brief').value;
                const scheduled = document.getElementById('scheduled').checked;

                const validSince = new Date(document.getElementById('validSince').value);
                const validUntil = new Date(document.getElementById('validUntil').value);
                const validReports = document.getElementById('validReports').value.split(',');

                const attributes = new Attributes();
                attributes.validSince = validSince;
                attributes.validUntil = validUntil;
                attributes.validReports = validReports;

                const expressionType = document.getElementById('expressionType').value;
                let expression;

                if (expressionType === 'Function') {
                    const functionType = document.getElementById('functionType').value;
                    expression = new Function();
                    expression.functionType = FunctionType[functionType];
                } else if (expressionType === 'Operation') {
                    const operatorType = document.getElementById('operatorType').value;
                    expression = new Operation();
                    expression.operatorType = OperatorType[operatorType];
                } else {
                    expression = new Expression();
                }

                const positionNode = new PositionNode();
                positionNode.ref = ref;
                positionNode.brief = brief;
                positionNode.scheduled = scheduled;
                positionNode.attributes = attributes;
                positionNode.expression = expression;

                document.getElementById('result').innerText = JSON.stringify(positionNode, null, 2);
            });
        });
    </script>
</head>
<body>
    <h1>Scheduling Rules Creator</h1>
    <form id="schedulingRuleForm">
        <label for="ref">Reference:</label>
        <input type="text" id="ref" name="ref"><br><br>

        <label for="brief">Brief:</label>
        <input type="text" id="brief" name="brief"><br><br>

        <label for="scheduled">Scheduled:</label>
        <input type="checkbox" id="scheduled" name="scheduled"><br><br>

        <label for="validSince">Valid Since:</label>
        <input type="date" id="validSince" name="validSince"><br><br>

        <label for="validUntil">Valid Until:</label>
        <input type="date" id="validUntil" name="validUntil"><br><br>

        <label for="validReports">Valid Reports (comma-separated):</label>
        <input type="text" id="validReports" name="validReports"><br><br>

        <label for="expressionType">Expression Type:</label>
        <select id="expressionType" name="expressionType">
            <option value="Expression">Expression</option>
            <option value="Function">Function</option>
            <option value="Operation">Operation</option>
        </select><br><br>

        <div id="functionTypeContainer">
            <label for="functionType">Function Type:</label>
            <select id="functionType" name="functionType">
                <option value="SUM">SUM</option>
                <option value="NEGATE">NEGATE</option>
            </select><br><br>
        </div>

        <div id="operatorTypeContainer">
            <label for="operatorType">Operator Type:</label>
            <select id="operatorType" name="operatorType">
                <option value="ADD">ADD</option>
                <option value="SUBTRACT">SUBTRACT</option>
                <option value="TIMES">TIMES</option>
                <option value="DIVIDE">DIVIDE</option>
            </select><br><br>
        </div>

        <button type="button" id="createRuleBtn">Create Rule</button>
    </form>
    <h2>Result</h2>
    <pre id="result"></pre>
</body>
</html>
